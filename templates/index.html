<!DOCTYPE html>
<html>
<head>
    <title>PowerMonitor</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
<div id="bar-graph"></div>
<button id="back-button">Back</button>

<script>
        // Function to load the initial bar graph data
        var isViewingDetailedData = false;

function loadBarGraph() {
    if (!isViewingDetailedData) {
        fetch('/graph_data')
            .then(response => response.json())
            .then(data => {
                console.log(data);
                var parsedData = JSON.parse(data);
                Plotly.newPlot('bar-graph', parsedData.data, parsedData.layout)
                    .then(function(gd) {
                        gd.on('plotly_click', handleBarClick);
                    });
            });
    }
    setTimeout(loadBarGraph, 30000);  // Call this function again after 30 seconds
}

function handleBarClick(event) {
    if (event && event.points) {
        var timestamp = event.points[0].x;
        var encodedTimestamp = encodeURIComponent(timestamp);

        isViewingDetailedData = true;

        fetch('/graph_data/' + encodedTimestamp)
            .then(response => response.json())
            .then(data => {
                var parsedData = JSON.parse(data);
                Plotly.newPlot('bar-graph', parsedData.data, parsedData.layout)
                    .then(function(gd) {
                        gd.on('plotly_click', handleBarClick);
                    });
            });
    }
}

function handleBackButtonClick() {
    isViewingDetailedData = false;
    loadBarGraph();
}

document.addEventListener('DOMContentLoaded', function() {
    loadBarGraph();

    var backButton = document.getElementById('back-button');
    backButton.addEventListener('click', handleBackButtonClick);
});

</script>
</body>
</html>
